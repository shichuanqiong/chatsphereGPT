import { useEffect, useRef, useState } from 'react';
import { db } from '../firebase';
import { onChildAdded, query, ref, limitToLast } from 'firebase/database';
function isImageUrl(s:string){return /^https?:\/\/\S+\.(gif|png|jpg|jpeg|webp)$/i.test(s)}
export default function MessageList({ path }:{ path:string }){const [items,setItems]=useState<any[]>([]);const endRef=useRef<HTMLDivElement>(null);useEffect(()=>{const q=query(ref(db,path),limitToLast(200));const arr:any[]=[];const off=onChildAdded(q,snap=>{arr.push({id:snap.key,...snap.val()});setItems([...arr]);setTimeout(()=>endRef.current?.scrollIntoView({behavior:'smooth'}),10)});return()=>off()},[path]);return(<div className='flex-1 overflow-y-auto p-4 space-y-3'>{items.map(m=>(<div key={m.id} className={`max-w-[70%] ${m.authorId===(window as any)._uid?'ml-auto text-right':''}`}><div className='text-xs text-white/60'>{m.authorId===(window as any)._uid?'You':(m.authorNickname||m.authorId)}</div>{isImageUrl(m.content||'')?(<img src={m.content} alt='gif' className='rounded-xl max-w-[360px]'/>):(<div className={`px-4 py-2 rounded-2xl ${m.authorId===(window as any)._uid?'bg-indigo-500/80 text-white':'bg-white/10 text-white'}`}>{m.content}</div>)}</div>))}<div ref={endRef}/></div>)}
