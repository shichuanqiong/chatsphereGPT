<!doctype html>
<html lang='en'>
<head>
  <meta charset='UTF-8'/>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'/>
  <title>ChatSphere</title>
  <script>
    // GitHub Pages SPA 路由修复
    // 当从 404.html 重定向回来时，恢复原始路径
    (function() {
      var redirect = sessionStorage.redirect;
      delete sessionStorage.redirect;
      if (redirect && redirect !== location.href) {
        history.replaceState(null, null, redirect);
      }
    }());
  </script>
</head>
<body class='bg-black'>
  <div id='root'></div>
  <script type='module' src='/src/main.tsx'></script>
  <script>
    // 处理从 404.html 过来的查询参数
    (function() {
      var l = window.location;
      if (l.search[0] === '?') {
        var q = l.search.slice(1).split('&').map(function(x) {
          return x.replace(/~and~/g, '&');
        }).join('&');
        if (window.history.replaceState) {
          window.history.replaceState(null, null, 
            l.pathname.slice(0, l.pathname.length - 1) + 
            (q ? '?' + q : '') + 
            l.hash
          );
        } else {
          l.replace(
            l.pathname.slice(0, l.pathname.length - 1) + 
            (q ? '?' + q : '') + 
            l.hash
          );
        }
      }
    }());
  </script>
</body>
</html>